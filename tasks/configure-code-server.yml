- name: Create code-server data dir
  file:
    path: "{{ code_server_data_dir }}"
    state: directory

- name: Copy code-server env file
  template:
    src: env
    dest: "{{ code_server_data_dir }}"
    mode: 0600
  notify: Restart code-server
  when: code_server_password is defined

- name: Copy TLS certificate
  become: "{{ tls_cert_remote }}"
  copy:
    remote_src: "{{ tls_cert_remote }}"
    src: "{{ tls_cert }}"
    dest: "{{ code_server_data_dir }}/tls.cert"
    mode: 0440
  notify: Restart code-server
  when: tls_cert is defined

- name: Copy TLS key
  become: "{{ tls_cert_remote }}"
  copy:
    remote_src: "{{ tls_key_remote }}"
    src: "{{ tls_key }}"
    dest: "{{ code_server_data_dir }}/tls.key"
    mode: 0440
  notify: Restart code-server
  when: tls_key is defined
